(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{cAP4:function(t,e,s){"use strict";s.d(e,"a",function(){return g});var a,i=s("tk/3"),r=s("2Vo4"),n=s("lJxs"),o=s("AytR"),u=new Uint8Array(16);function l(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(u)}for(var c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,d=function(t){return"string"==typeof t&&c.test(t)},h=[],p=0;p<256;++p)h.push((p+256).toString(16).substr(1));var m=function(t,e,s){var a=(t=t||{}).random||(t.rng||l)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){s=s||0;for(var i=0;i<16;++i)e[s+i]=a[i];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase();if(!d(s))throw TypeError("Stringified UUID is invalid");return s}(a)};class k{constructor(){this.id=m(),this.items=[]}}var b=s("fXoL");let g=(()=>{class t{constructor(t){this.http=t,this.baseUrl=o.a.apiUrl,this.basketSource=new r.a(null),this.basket$=this.basketSource.asObservable(),this.basketTotalSource=new r.a(null),this.basketTotal$=this.basketTotalSource.asObservable(),this.shipping=0}getBasket(t){let e=new i.d;return e=e.append("id",t),this.http.get(this.baseUrl+"basket",{params:e}).pipe(Object(n.a)(t=>{this.basketSource.next(t.data),this.shipping=t.data.shippingPrice,this.calculateTotals()}))}setBasket(t){return this.http.post(this.baseUrl+"basket",t).subscribe(t=>{this.basketSource.next(t.data),this.calculateTotals()},t=>{console.log(t)})}getCurrentBasketValue(){return this.basketSource.value}addItemToBasket(t,e=1){var s;const a=this.mapProductItemToBasketItem(t,e),i=null!==(s=this.getCurrentBasketValue())&&void 0!==s?s:this.createBasket();i.items=this.addOrUpdateItem(i.items,a,e),this.setBasket(i)}incrementItemQuantity(t){const e=this.getCurrentBasketValue(),s=e.items.findIndex(e=>e.id===t.id);e.items[s].quantity++,this.setBasket(e)}decrementItemQuantity(t){const e=this.getCurrentBasketValue(),s=e.items.findIndex(e=>e.id===t.id);e.items[s].quantity>1?(e.items[s].quantity--,this.setBasket(e)):this.removeItemFromBasket(t)}removeItemFromBasket(t){const e=this.getCurrentBasketValue();e.items.some(e=>e.id===t.id)&&(e.items=e.items.filter(e=>e.id!==t.id),e.items.length>0?this.setBasket(e):this.deleteBasket(e))}deleteLocalBasket(t){this.basketSource.next(null),this.basketTotalSource.next(null),localStorage.removeItem("basket_id")}deleteBasket(t){return this.http.delete(this.baseUrl+"basket?id="+t.id).subscribe(()=>{this.basketSource.next(null),this.basketTotalSource.next(null),localStorage.removeItem("basket_id")},t=>{console.log(t)})}calculateTotals(){const t=this.getCurrentBasketValue(),e=this.shipping,s=t.items.reduce((t,e)=>e.price*e.quantity+t,0);this.basketTotalSource.next({shipping:e,total:s+e,subtotal:s})}addOrUpdateItem(t,e,s){console.log("here");const a=t.findIndex(t=>t.id===e.id);return-1===a?(e.quantity=s,t.push(e)):t[a].quantity+=s,t}createBasket(){const t=new k;return localStorage.setItem("basket_id",t.id),t}mapProductItemToBasketItem(t,e){return{id:t.id,productName:t.title,price:t.originalPrice,pictureUrl:t.coverImageUrl,quantity:e,type:t.productType.name}}}return t.\u0275fac=function(e){return new(e||t)(b.Vb(i.b))},t.\u0275prov=b.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);