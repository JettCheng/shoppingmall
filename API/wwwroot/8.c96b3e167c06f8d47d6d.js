(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"MdZ+":function(t,e,o){"use strict";o.r(e),o.d(e,"CmsModule",function(){return w});var r=o("SVse"),i=o("iInd"),c=o("6/Dz"),s=o("XJHN"),n=o("8Y7J"),a=o("mwRl"),l=o("EApP"),p=o("a4eG"),d=o("s7LF");const u=["search"];function b(t,e){if(1&t&&(n.Vb(0,"option",20),n.Gc(1),n.Ub()),2&t){const t=e.$implicit;n.mc("value",t.id),n.Cb(1),n.Ic(" ",t.name," ")}}function h(t,e){if(1&t&&(n.Vb(0,"span",33),n.Gc(1),n.Ub()),2&t){const t=n.ec().$implicit;n.Cb(1),n.Ic("\u5206\u985e\uff1a ",t.productType.name," ")}}function m(t,e){if(1&t){const t=n.Wb();n.Vb(0,"tr"),n.Vb(1,"th",21),n.Vb(2,"div",22),n.Qb(3,"img",23),n.Ub(),n.Ub(),n.Vb(4,"th",21),n.Vb(5,"div",22),n.Vb(6,"div",24),n.Vb(7,"h5",25),n.Vb(8,"a",26),n.Gc(9),n.Ub(),n.Ub(),n.Ec(10,h,2,1,"span",27),n.Ub(),n.Ub(),n.Ub(),n.Vb(11,"td",28),n.Vb(12,"strong"),n.Gc(13),n.fc(14,"currency"),n.Ub(),n.Ub(),n.Vb(15,"td"),n.Gc(16),n.fc(17,"slice"),n.Ub(),n.Vb(18,"td",29),n.Vb(19,"a",30),n.Vb(20,"i",31),n.cc("click",function(){n.yc(t);const o=e.$implicit;return n.ec().removeProduct(o.id)}),n.Ub(),n.Ub(),n.Ub(),n.Vb(21,"td",29),n.Vb(22,"a",26),n.Qb(23,"i",32),n.Ub(),n.Ub(),n.Ub()}if(2&t){const t=e.$implicit;n.Cb(3),n.nc("src",t.coverImage,n.Ac),n.nc("alt",t.productName),n.Cb(5),n.oc("routerLink","/shop/",t.id,""),n.Cb(1),n.Hc(t.title),n.Cb(1),n.mc("ngIf",t.productType),n.Cb(3),n.Hc(n.jc(14,8,t.originalPrice,"TWD",!0,"1.0-0")),n.Cb(3),n.Ic("",n.ic(17,13,t.description,0,100),"..."),n.Cb(6),n.oc("routerLink","/product-management/update/",t.id,"")}}function g(t,e){if(1&t&&(n.Vb(0,"h1",34),n.Gc(1),n.Ub()),2&t){const t=n.ec();n.Cb(1),n.Hc(t.error)}}let f=(()=>{class t{constructor(t,e){this.shopService=t,this.toastr=e,this.paginationParams={PageIndex:3,TotalCount:30,PageSize:5},this.products=[],this.shopParams=new s.a,this.productTypeList=[]}ngOnInit(){this.getProducts(),this.getProductTypes()}removeProduct(t){this.shopService.removeProduct(t).subscribe(e=>{this.toastr.success("\u522a\u9664\u6210\u529f"),this.products.forEach(e=>{e.id===t&&this.products.splice(this.products.indexOf(e))})},t=>{console.log(t)})}editProduct(){}onProductTypeSelected(t){if(null===t)return;const e=this.shopService.getShopParams(),o=this.shopService.getPaginationParams();e.productTypeId=t,o.PageIndex=1,this.shopService.setShopParams(e),this.shopService.setPaginationParams(o),this.getProducts()}onSearch(){const t=this.shopService.getShopParams(),e=this.shopService.getPaginationParams();t.keyword=this.searchTerm.nativeElement.value,e.PageIndex=1,this.shopService.setShopParams(t),this.shopService.setPaginationParams(e),this.getProducts()}onPageChanged(t){this.shopService.getShopParams();const e=this.shopService.getPaginationParams();e.PageIndex!==t&&(e.PageIndex=t,this.shopService.setPaginationParams(e),this.getProducts())}getProducts(){this.shopService.getProducts().subscribe(t=>{this.products=t.body.data;var e=t.headers.get("x-pagination");this.paginationParams=JSON.parse(e),console.log(t.body.data)},t=>{404===t.error.statusCode&&(this.products=[],this.shopParams=new s.a,this.paginationParams=new c.a,this.error=t.error.message)})}getProductTypes(){this.shopService.getProductTypes().subscribe(t=>{this.productTypeList=t.data.filter(t=>1===t.level),console.log(this.productTypeList),this.productTypeList.unshift({id:"",name:"\u5168\u90e8",level:1,parentId:"",childType:null})},t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(n.Pb(a.a),n.Pb(l.b))},t.\u0275cmp=n.Jb({type:t,selectors:[["app-cms"]],viewQuery:function(t,e){if(1&t&&n.Kc(u,1),2&t){let t;n.vc(t=n.dc())&&(e.searchTerm=t.first)}},decls:35,vars:6,consts:[[1,"container","mt-5"],[1,"row"],[1,"col-5"],[1,"form-inline","justify-content-center"],[1,"label",2,"width","20%"],[1,"form-select","form-control","ml-2",2,"width","60%",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"col-4"],["type","text","placeholder","\u8acb\u8f38\u5165\u5546\u54c1\u6a19\u984c\u95dc\u9375\u5b57",1,"form-control","mr-2",3,"keyup.enter"],["search",""],[1,"btn","btn-secondary","fa","fa-search",3,"click"],[1,"col-3",2,"text-align","right"],["routerLink","/product-management/creation/",1,"btn","btn-primary","fa","fa-plus"],[1,"col-12"],[1,"table","table-hover",2,"cursor","pointer"],[1,"thead-dark"],[4,"ngFor","ngForOf"],["class","d-flex justify-content-center mt-5 mb-5",4,"ngIf"],[1,"d-flex","justify-content-center"],[3,"pageSize","totalCount","pageIndex","pageChanged"],[3,"value"],["scope","row"],[1,"p-2"],[1,"img-fluid",2,"max-height","100px",3,"src","alt"],[1,"ml-3","d-inline-block","align-middle"],[1,"mb-0"],[1,"text-dark",3,"routerLink"],["class","text-muted font-weight-normal font-italic d-block",4,"ngIf"],[1,"align-middle"],[1,"align-middle","text-center"],[1,"text-danger","mr-2"],[1,"fa","fa-trash",2,"font-size","2em","cursor","pointer",3,"click"],[1,"fa","fa-pencil",2,"font-size","2em","cursor","pointer"],[1,"text-muted","font-weight-normal","font-italic","d-block"],[1,"d-flex","justify-content-center","mt-5","mb-5"]],template:function(t,e){1&t&&(n.Vb(0,"div",0),n.Vb(1,"div",1),n.Vb(2,"div",2),n.Vb(3,"div",3),n.Vb(4,"div",4),n.Gc(5,"\u5546\u54c1\u5206\u985e"),n.Ub(),n.Vb(6,"select",5),n.cc("change",function(t){return e.onProductTypeSelected(t.target.value)}),n.Ec(7,b,2,2,"option",6),n.Ub(),n.Ub(),n.Ub(),n.Vb(8,"div",7),n.Vb(9,"div",3),n.Vb(10,"input",8,9),n.cc("keyup.enter",function(){return e.onSearch()}),n.Ub(),n.Vb(12,"button",10),n.cc("click",function(){return e.onSearch()}),n.Ub(),n.Ub(),n.Ub(),n.Vb(13,"div",11),n.Vb(14,"button",12),n.Gc(15,"\u65b0\u589e\u5546\u54c1"),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(16,"div",0),n.Vb(17,"div",1),n.Vb(18,"div",13),n.Vb(19,"table",14),n.Vb(20,"thead",15),n.Vb(21,"tr"),n.Qb(22,"th"),n.Qb(23,"th"),n.Vb(24,"th"),n.Gc(25,"\u50f9\u683c"),n.Ub(),n.Vb(26,"th"),n.Gc(27,"\u63cf\u8ff0"),n.Ub(),n.Qb(28,"th"),n.Qb(29,"th"),n.Ub(),n.Ub(),n.Vb(30,"tbody"),n.Ec(31,m,24,17,"tr",16),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ec(32,g,2,1,"h1",17),n.Vb(33,"div",18),n.Vb(34,"app-pager",19),n.cc("pageChanged",function(t){return e.onPageChanged(t)}),n.Ub(),n.Ub()),2&t&&(n.Cb(7),n.mc("ngForOf",e.productTypeList),n.Cb(24),n.mc("ngForOf",e.products),n.Cb(1),n.mc("ngIf",e.paginationParams.TotalCount<=0),n.Cb(2),n.mc("pageSize",e.paginationParams.PageSize)("totalCount",e.paginationParams.TotalCount)("pageIndex",e.paginationParams.PageIndex))},directives:[r.l,i.d,r.m,p.a,d.m,d.r,i.f],pipes:[r.d,r.r],styles:[""]}),t})();var v=o("XGsO"),y=o("gA0Q");function P(t,e){1&t&&(n.Vb(0,"span",23),n.Gc(1,"\b\u300e\u5546\u54c1\u5206\u985e\u300f\u70ba\u5fc5\u586b"),n.Ub())}function I(t,e){if(1&t&&(n.Vb(0,"option",24),n.Gc(1),n.Ub()),2&t){const t=e.$implicit;n.mc("value",t.id),n.Cb(1),n.Ic(" ",t.name," ")}}function T(t,e){if(1&t&&(n.Vb(0,"option",24),n.Gc(1),n.Ub()),2&t){const t=e.$implicit;n.mc("value",t.id),n.Cb(1),n.Ic(" ",t.name," ")}}function V(t,e){if(1&t){const t=n.Wb();n.Vb(0,"div",25),n.Qb(1,"img",26),n.Vb(2,"button",27),n.cc("click",function(){n.yc(t);const o=e.index;return n.ec().onDeleteLocalProductImage(o)}),n.Ub(),n.Ub()}if(2&t){const t=e.$implicit;n.Cb(1),n.mc("src",t.small,n.Ac)}}let U=(()=>{class t{constructor(t,e,o){this.shopService=t,this.toastr=e,this.fb=o,this.update=new n.n,this.productTypeLevel0Selected="",this.productTypeLevel1Selected="",this.productTypeLevel1Filted=[],this.isImageEmpty=!0,this.galleryOptions=[],this.galleryImages=[],this.initialProductTypeOption={id:"",level:0,parentId:"",name:"\u8acb\u9078\u64c7",childType:[]}}ngOnChanges(t){this.initialGalleryImages(),this.setFormValue()}ngOnInit(){}onSubmit(){this.productInfoForm.invalid&&""===this.productTypeLevel1Selected&&this.toastr.error("\u8acb\u9078\u64c7\u5546\u54c1\u5206\u985e"),this.productInfoForm.get("productTypeId").setValue(this.productTypeLevel1Selected),this.galleryImages.forEach(t=>{this.productInfoForm.get("productImages").push(this.fb.group({url:t.small}))}),this.productInfoForm.get("coverImage").setValue(this.galleryImages[1].small),0===this.OperationType&&this.shopService.createProduct(this.productInfoForm.value).subscribe(()=>{this.productInfoForm.reset(),this.toastr.success("\u5efa\u7acb\u6210\u529f"),this.galleryImages=[]},t=>{this.toastr.error("\u5efa\u7acb\u5931\u6557"),console.log(t)}),0===this.OperationType&&this.shopService.updateProduct(this.productId,this.productInfoForm.value).subscribe(()=>{this.productInfoForm.reset(),this.toastr.success("\u5efa\u7acb\u6210\u529f"),this.galleryImages=[]},t=>{this.toastr.error("\u5efa\u7acb\u5931\u6557"),console.log(t)})}onDeleteLocalProductImage(t){this.galleryImages.splice(t,1)}onProductTypeLevel0Selected(t){this.productTypeLevel0Selected=t,this.filtProductTypeLevel1(t)}onProductTypeLevel1Selected(t){this.productTypeLevel1Selected=t}onSetLocalProductImage(t){null!==this.productInfoForm.get("url").value&&(this.isImageEmpty&&this.galleryImages.shift(),this.galleryImages.push({small:t,medium:t,big:t}),this.isImageEmpty=!1,this.productInfoForm.get("url").reset())}setFormValue(){console.log(this.productInfoForm.get("productImages").value),this.productInfoForm.get("productImages").value.forEach(t=>{this.onSetLocalProductImage(t),console.log(t),console.log(this.galleryImages)})}initialGalleryImages(){this.galleryOptions=[{width:"600px",height:"600px",thumbnailsColumns:4,arrowPrevIcon:"fa fa-chevron-left",arrowNextIcon:"fa fa-chevron-right",imageAnimation:v.a.Slide}]}filtProductTypeLevel1(t){this.productTypeLevel1Filted=this.productTypeLevel1.filter(e=>e.parentId===t),this.productTypeLevel1Filted.unshift(this.initialProductTypeOption)}}return t.\u0275fac=function(e){return new(e||t)(n.Pb(a.a),n.Pb(l.b),n.Pb(d.b))},t.\u0275cmp=n.Jb({type:t,selectors:[["app-product-info"]],inputs:{productInfoForm:"productInfoForm",productId:"productId",productTypeLevel0:"productTypeLevel0",productTypeLevel1:"productTypeLevel1",OperationType:"OperationType"},outputs:{update:"update"},features:[n.Ab],decls:37,vars:11,consts:[[1,"container"],[3,"formGroup","ngSubmit"],["ngForm","ngForm"],[1,"row","mt-3"],[1,"col-6",2,"height","400px"],[1,"ngx-gallery",3,"options","images"],[1,"col-6"],[1,"card","shadow-sm","bg-info","text-white","mb-3"],[1,"card-body","d-flex","flex-column"],["formControlName","title",3,"label"],["formControlName","originalPrice",3,"label"],[1,"mt-2"],["class","invalid-feedback d-block",4,"ngIf"],["ng-model","productTypeLevel0[2]",1,"form-select","form-control","mt-2",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"form-select","form-control","mt-2","mb-3",3,"disabled","change"],[1,"row"],["class","col-4 mb-3",4,"ngFor","ngForOf"],["type","text","formControlName","url","placeholder","\u8acb\u8f38\u5165\u5716\u7247\u7db2\u5740",1,"form-control"],["type","button",1,"btn","btn-dark","fa","fa-plus","mt-2",3,"click"],[1,"col-12"],["formControlName","description",3,"label"],["type","submit",1,"btn","btn-lg","btn-primary","btn-block","mb-5"],[1,"invalid-feedback","d-block"],[3,"value"],[1,"col-4","mb-3"],[2,"width","60%",3,"src"],["type","button",1,"btn","btn-primary","fa","fa-trash",2,"width","25%","height","100%",3,"click"]],template:function(t,e){if(1&t&&(n.Vb(0,"div",0),n.Vb(1,"form",1,2),n.cc("ngSubmit",function(){return e.onSubmit()}),n.Vb(3,"div",3),n.Vb(4,"div",4),n.Qb(5,"ngx-gallery",5),n.Ub(),n.Vb(6,"div",6),n.Vb(7,"div",7),n.Vb(8,"div",8),n.Qb(9,"app-text-input",9),n.Qb(10,"app-text-input",10),n.Ub(),n.Ub(),n.Vb(11,"div",7),n.Vb(12,"div",8),n.Vb(13,"h6",11),n.Gc(14,"\uff0a\u5546\u54c1\u5206\u985e"),n.Ec(15,P,2,0,"span",12),n.Ub(),n.Vb(16,"select",13),n.cc("change",function(t){return e.onProductTypeLevel0Selected(t.target.value)}),n.Ec(17,I,2,2,"option",14),n.Ub(),n.Vb(18,"select",15),n.cc("change",function(t){return e.onProductTypeLevel1Selected(t.target.value)}),n.Ec(19,T,2,2,"option",14),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(20,"div",6),n.Vb(21,"div",16),n.Ec(22,V,3,1,"div",17),n.Ub(),n.Ub(),n.Vb(23,"div",6),n.Vb(24,"div",7),n.Vb(25,"div",8),n.Qb(26,"input",18),n.Vb(27,"button",19),n.cc("click",function(){return e.onSetLocalProductImage(e.productInfoForm.get("url").value)}),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(28,"div",3),n.Vb(29,"div",20),n.Vb(30,"div",7),n.Vb(31,"div",8),n.Qb(32,"app-text-input",21),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(33,"div",3),n.Vb(34,"div",20),n.Vb(35,"button",22),n.Gc(36,"\u78ba\u8a8d\u9001\u51fa"),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub()),2&t){const t=n.wc(2);n.Cb(1),n.mc("formGroup",e.productInfoForm),n.Cb(4),n.mc("options",e.galleryOptions)("images",e.galleryImages),n.Cb(4),n.mc("label","\uff0a\u6a19\u984c"),n.Cb(1),n.mc("label","\uff0a\u50f9\u683c"),n.Cb(5),n.mc("ngIf",""===e.productTypeLevel1Selected&&t.submitted),n.Cb(2),n.mc("ngForOf",e.productTypeLevel0),n.Cb(1),n.mc("disabled",""===e.productTypeLevel0Selected),n.Cb(1),n.mc("ngForOf",e.productTypeLevel1Filted),n.Cb(3),n.mc("ngForOf",e.galleryImages),n.Cb(10),n.mc("label","\uff0a\u5546\u54c1\u63cf\u8ff0")}},directives:[d.q,d.l,d.f,v.b,y.a,d.k,d.d,r.m,r.l,d.a,d.m,d.r],styles:[""]}),t})(),F=(()=>{class t{constructor(t,e,o){this.fb=t,this.shopService=e,this.toastr=o,this.initialProductTypeOption={id:"",level:0,parentId:"",name:"\u8acb\u9078\u64c7",childType:[]},this.galleryOptions=[],this.galleryImages=[]}ngOnInit(){this.initialProductForCreationForm(),this.getProductTypes()}initialProductForCreationForm(){this.productForCreationForm=this.fb.group({title:[null,[d.p.required]],description:[null,[d.p.required]],originalPrice:[null,[d.p.required,d.p.pattern("^[0-9]*$")]],productTypeId:[null],coverImage:[null],productImages:this.fb.array([]),url:[null]})}getProductTypes(){this.shopService.getProductTypes().subscribe(t=>{this.productTypeLevel0=t.data.filter(t=>0===t.level),this.productTypeLevel1=t.data.filter(t=>1===t.level),this.productTypeLevel0.unshift(this.initialProductTypeOption)},t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(n.Pb(d.b),n.Pb(a.a),n.Pb(l.b))},t.\u0275cmp=n.Jb({type:t,selectors:[["app-product-creation"]],decls:1,vars:3,consts:[[3,"productInfoForm","productTypeLevel0","productTypeLevel1"]],template:function(t,e){1&t&&n.Qb(0,"app-product-info",0),2&t&&n.mc("productInfoForm",e.productForCreationForm)("productTypeLevel0",e.productTypeLevel0)("productTypeLevel1",e.productTypeLevel1)},directives:[U],styles:[""]}),t})();var S=o("GlbF");const L=[{path:"",component:f},{path:"creation",component:F,data:{breadcrumb:"\u65b0\u589e\u5546\u54c1"}},{path:"update/:id",component:(()=>{class t{constructor(t,e,o,r){this.fb=t,this.activateRoute=e,this.shopService=o,this.bcService=r,this.initialProductTypeOption={id:"",level:0,parentId:"",name:"\u8acb\u9078\u64c7",childType:[]}}ngOnInit(){this.initialProductForUpdateForm(),this.loadProduct(),this.getProductTypes()}setFormValue(){this.productForUpdateForm.get("title").setValue(this.product.title),this.productForUpdateForm.get("originalPrice").setValue(this.product.originalPrice),this.productForUpdateForm.get("description").setValue(this.product.description),this.productForUpdateForm.get("productTypeId").setValue(this.product.productType.id),this.product.productImages.forEach(t=>{this.productForUpdateForm.get("productImages").push(this.fb.group({i:t}))})}initialProductForUpdateForm(){this.productForUpdateForm=this.fb.group({title:[null,[d.p.required]],description:[null,[d.p.required]],originalPrice:[null,[d.p.required,d.p.pattern("^[0-9]*$")]],productTypeId:[null],coverImage:[null],productImages:this.fb.array([]),url:[null]})}loadProduct(){const t=this.activateRoute.snapshot.paramMap.get("id");this.shopService.getProduct(t).subscribe(t=>{this.product=t.data,this.setFormValue(),this.bcService.set("@productDetails",this.product.title)},t=>{console.log(t)})}getProductTypes(){this.shopService.getProductTypes().subscribe(t=>{this.productTypeLevel0=t.data.filter(t=>0===t.level),this.productTypeLevel1=t.data.filter(t=>1===t.level),this.productTypeLevel0.unshift(this.initialProductTypeOption)},t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(n.Pb(d.b),n.Pb(i.a),n.Pb(a.a),n.Pb(S.c))},t.\u0275cmp=n.Jb({type:t,selectors:[["app-product-update"]],decls:3,vars:4,consts:[[3,"productInfoForm","productId","productTypeLevel0","productTypeLevel1"]],template:function(t,e){1&t&&(n.Vb(0,"h1"),n.Gc(1,"\u62b1\u6b49\u529f\u80fd\u5c1a\u672a\u5b8c\u6210"),n.Ub(),n.Qb(2,"app-product-info",0)),2&t&&(n.Cb(2),n.mc("productInfoForm",e.productForUpdateForm)("productId",e.product.id)("productTypeLevel0",e.productTypeLevel0)("productTypeLevel1",e.productTypeLevel1))},directives:[U],styles:[""]}),t})(),data:{breadcrumb:"\u4fee\u6539\u5546\u54c1"}}];let C=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.Nb({type:t}),t.\u0275inj=n.Mb({imports:[[i.g.forChild(L)],i.g]}),t})();var x=o("PCNd");let w=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.Nb({type:t}),t.\u0275inj=n.Mb({imports:[[r.c,C,x.a]]}),t})()}}]);